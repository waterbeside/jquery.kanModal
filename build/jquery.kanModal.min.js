/*!
 jquery.kanModal.js v1.0.1 | https://github.com/waterbeside/jquery.kanModal (2017-06-02)
 Copyright (c) 簡(Kan) <waterbeside@126.com>
*/

!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t,o){"use strict";function s(o){t.fn[n].options=this.options=t.extend({},t.fn[n].defaults,o),this.$modal=t(this.options.target).attr("class","modal fade").hide();var s=this;!function(){""===s.options.title&&(s.options.title="&nbsp;")}()}var n="kanModal";t.extend(s.prototype,{show:function(){var s,e=this;if(this.options.nobackdrop||(s=t(".modal-backdrop")),this.$modal.length||(this.$modal=t('<div class="modal fade" id="'+this.options.target.substr(1)+'"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"></h4></div><div class="modal-body"></div></div></div></div>').appendTo(this.options.appendTo).hide()),e.options.btns){if(!this.$modal.find(".modal-footer").length){this.$modal.find(".modal-body").after('<div class="modal-footer"></div>')}this.$modal.find(".modal-footer").html(""),e.options.btns&&t.fn[n].createBtnBar.call(this,e)}else this.$modal.find(".modal-footer").remove();this.$modal.find(".modal-header .modal-title").html(this.options.title),this.options.cssclass!==o&&this.$modal.attr("class","modal fade "+this.options.cssclass);var i=this.$modal.find(".modal-dialog");if(i.removeAttr("style"),this.options.width!==o&&i.width(this.options.width),this.options.left!==o&&i.css({left:this.options.left}),this.options.height!==o&&this.$modal.height(this.options.height),this.options.top!==o&&i.css({top:this.options.top}),this.options.keyboard&&this.escape(),this.options.nobackdrop||(s.length||(s=t('<div class="modal-backdrop fade" />').appendTo(this.options.appendTo)),s.addClass("in")),this.$modal.off("close."+n).on("close."+n,function(){e.close.call(e)}),e.options.remote!==o&&""!==e.options.remote&&"#"!==e.options.remote?e.load():(e.$modal.find(".modal-body").html(e.options.content),"function"==typeof e.options.onLoadSuccess&&e.options.onLoadSuccess(e)),this.$modal.show(),setTimeout(function(){e.$modal.addClass("in")},200),t("body").addClass("modal-open"),this.$modal.scrollTop(0),this.options.handle){var a=this.$modal.find(this.options.handle);if(this.options.draggable){i.addClass("modal-draggable").css({position:"absolute"});var l=this.options.left!==o?this.options.left:(t("body").width()-i.width())/2;i.addClass().css({left:l});var d,r,c=this.$modal,f=!1,m=this.$modal.find(".modal-draggable");a.on({mousedown:function(o){m.length>0&&(f=!0,d=o.clientX-m.offset().left+parseInt(m.css("marginLeft")),r=o.clientY-m.offset().top+parseInt(m.css("marginTop"))-c.scrollTop()+t(document).scrollTop(),this.setCapture())},mousemove:function(t){if(m.length>0&&f){var o=(t=t||window.event).clientX-d,s=t.clientY-r;return m.css({left:o+"px",top:s+"px"}),!1}},mouseup:function(t){m.length>0&&f&&(f=!1,m[0].releaseCapture(),t.cancelBubble=!0)}}).addClass("modal-handle")}else i.removeClass("modal-draggable"),a.unbind("mousedown").unbind("mousemove").unbind("mouseup").removeClass("modal-handle")}return this},load:function(o){var s=this;o=o||s.options.remote,t.ajax({type:"get",dataType:"html",cache:s.options.cache,url:o,data:s.options.data,success:function(t){s.$modal.find(".modal-body").html(t),s.options.cache&&void 0===s.options.remote_o&&(s.options.content=t,s.options.remote_o=s.options.remote,delete s.options.remote),"function"==typeof s.options.onLoadSuccess&&s.options.onLoadSuccess(s)}})},reload:function(){var t=void 0!==this.options.remote_o?this.options.remote_o:void 0!==this.options.remote?this.options.remote:"";""!==t?this.load(t):this.options.content&&(this.$modal.find(".modal-body").html(this.options.content),"function"==typeof this.options.onLoadSuccess&&this.options.onLoadSuccess(this))},close:function(){var s=t(".modal:visible").length,e=this.$modal;return this.$modal.removeClass("in").off("."+n).find(".modal-body").html(""),setTimeout(function(){e.hide()},200),this.options.cssclass!==o&&this.$modal.removeClass(this.options.cssclass),t(document).off("keyup."+n),s<2&&(t("body").removeClass("modal-open"),t(".modal-backdrop").remove()),"function"==typeof this.options.onClose&&this.options.onClose.call(this,this.options),this},destroy:function(){return this.$modal.remove(),t(document).off("keyup."+n),t(".modal-backdrop").remove(),t("body").removeClass("modal-open"),this.$modal=null,this},escape:function(){var o=this;t(document).on("keyup."+n,function(t){27===t.which&&o.close()})}}),t.fn[n]=function(o){return this.each(function(){var e;if(!(e=t.data(this,n))){var i=t(this),a=i.data(),l=t.extend({},o,a);""!==i.attr("href")&&"#"!==i.attr("href")&&(l.remote=i.attr("href")),e=new s(l),t.data(this,n,e)}e.show()})},t[n]=function(t){return new s(t)},t.fn[n].defaultBtns=function(){var o=[];return o.submit={id:"submit",title:"提 交",icon:"fa fa-save",btnClass:"btn btn-primary modal-btn-submit",attrString:'data-loading-text="提交中.."',onclick:function(o,s){var e=t.fn[n].defaultBtnsGetForm(s);return e.length>0?e.submit():s.$modal.trigger("close"),!1}},o.reset={id:"reset",title:"重置",icon:"fa fa-undo",btnClass:"btn  btn-default modal-btn-reset",onclick:function(o,s){t.fn[n].defaultBtnsGetForm(s)[0].reset()}},o.cancel={id:"cancel",title:"取消",icon:"fa fa-times",btnClass:"btn  btn-default modal-btn-close",onclick:function(t,o){o.$modal.trigger("close")}},o.close={id:"close",title:"關閉",icon:"fa fa-times",btnClass:"btn  btn-default modal-btn-close",onclick:function(t,o){o.$modal.trigger("close")}},o.refresh={id:"refresh",title:"刷新",icon:"fa fa-refresh",btnClass:"btn  btn-default modal-btn-refrest",onclick:function(t,o){o.reload()}},o},t.fn[n].defaultBtnsGetForm=function(o){var s=o.$modal.find("form").length;if(1===s)return t(o.$modal.find("form"));if(s>1){var n=o.$modal.find(".table_edit").find("form");return n.length>0?n:o.$modal.find(".form-modal-submit")}return!1},t.fn[n].createBtn=function(o,s){var n={tag:"a",btnClass:"btn btn-default",icon:"fa fa-arrow-right",attrString:""},e=t.extend({},n,s),i="a"===e.tag?' href="javascript:void(0)"':"",a="string"==typeof e.onclick?' onclick="'+e.onclick+'"':"",l="<"+e.tag+i+a+' class="'+e.btnClass+'" '+e.attrString+">";l+='<i class="'+e.icon+'"></i>&nbsp;&nbsp;'+e.title,l+="</"+e.tag+">";var d=t(l);return"function"==typeof e.onclick&&d.click(function(){e.onclick(this,o)}),d},t.fn[n].createBtnBar=function(o){var s=o.$modal.find(".modal-footer");if("string"==typeof o.options.btns)s.html(o.options.btns);else if("object"==typeof o.options.btns){var e,i,a=["submit","reset","close","cancel","refresh"];t.each(o.options.btns,function(l,d){var r=t.fn[n].defaultBtns();if("string"==typeof d){var c=t.trim(d.toLowerCase());e=t("<span>"+d+"</span>"),t.inArray(c,a)>-1&&(i=r[c],e=t.fn[n].createBtn(o,i))}else if("object"==typeof d){var f=void 0===d.id?"":t.trim(d.id.toLowerCase());i=t.inArray(f,a)<0?d:t.extend({},r[f],d),e=t.fn[n].createBtn(o,i)}s.append(e)})}},t.fn[n].options={},t.fn[n].defaults={title:"&nbsp;",target:"#modal",content:"",appendTo:"body",cache:!1,keyboard:!0,nobackdrop:!1,draggable:!1,data:"",handle:".modal-header",btns:["refresh","cancel","submit"]},t(document).on("click."+n,'[data-trigger="modal"]',function(){if(t(this)[n](),t(this).is("a"))return!1}).on("click."+n,'[data-dismiss="modal"]',function(o){o.preventDefault(),t(this).closest(".modal").trigger("close")})});