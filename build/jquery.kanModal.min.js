/*!
 jquery.kanModal.js v1.0.1 | https://github.com/waterbeside/jquery.kanModal (2017-05-26)
 Copyright (c) 簡(Kan) <waterbeside@126.com>
*/

!function(t,o){"use strict";function s(o){t.fn[n].options=this.options=t.extend({},t.fn[n].defaults,o),this.$modal=t(this.options.target).attr("class","modal fade").hide();var s=this;!function(){""===s.options.title&&(s.options.title="&nbsp;")}()}var n="kanModal";t.extend(s.prototype,{show:function(){var o,s=this;if(this.options.nobackdrop||(o=t(".modal-backdrop")),!this.$modal.length){var i=this.options.btns?'<div class="modal-footer"></div>':"";this.$modal=t('<div class="modal fade" id="'+this.options.target.substr(1)+'"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"></h4></div><div class="modal-body"></div>'+i+"</div></div></div>").appendTo(this.options.appendTo).hide()}s.options.btns&&(this.$modal.find(".modal-footer").html(""),s.options.btns&&t.fn[n].createBtnBar.call(this,s)),this.$modal.find(".modal-header .modal-title").html(this.options.title),void 0!==this.options.cssclass&&this.$modal.attr("class","modal fade "+this.options.cssclass);var e=this.$modal.find(".modal-dialog");if(e.removeAttr("style"),void 0!==this.options.width&&e.width(this.options.width),void 0!==this.options.left&&e.css({left:this.options.left}),void 0!==this.options.height&&this.$modal.height(this.options.height),void 0!==this.options.top&&e.css({top:this.options.top}),this.options.keyboard&&this.escape(),this.options.nobackdrop||(o.length||(o=t('<div class="modal-backdrop fade" />').appendTo(this.options.appendTo)),o.addClass("in")),this.$modal.off("close."+n).on("close."+n,function(){s.close.call(s)}),void 0!==s.options.remote&&""!==s.options.remote&&"#"!==s.options.remote?s.load():(s.$modal.find(".modal-body").html(s.options.content),"function"==typeof s.options.onLoadSuccess&&s.options.onLoadSuccess(s)),this.$modal.show(),setTimeout(function(){s.$modal.addClass("in")},200),t("body").addClass("modal-open"),this.$modal.scrollTop(0),this.options.handle){var a=this.$modal.find(this.options.handle);if(this.options.draggable){e.addClass("modal-draggable").css({position:"absolute"});var d=void 0!==this.options.left?this.options.left:(t("body").width()-e.width())/2;e.addClass().css({left:d});var l,r,c=this.$modal,f=!1,m=this.$modal.find(".modal-draggable");a.on({mousedown:function(o){m.length>0&&(f=!0,l=o.clientX-m.offset().left+parseInt(m.css("marginLeft")),r=o.clientY-m.offset().top+parseInt(m.css("marginTop"))-c.scrollTop()+t(document).scrollTop(),this.setCapture())},mousemove:function(t){if(m.length>0&&f){var o=(t=t||window.event).clientX-l,s=t.clientY-r;return m.css({left:o+"px",top:s+"px"}),!1}},mouseup:function(t){m.length>0&&f&&(f=!1,m[0].releaseCapture(),t.cancelBubble=!0)}}).addClass("modal-handle")}else e.removeClass("modal-draggable"),a.unbind("mousedown").unbind("mousemove").unbind("mouseup").removeClass("modal-handle")}return this},load:function(o){var s=this;o=o||s.options.remote,t.ajax({type:"get",dataType:"html",cache:s.options.cache,url:o,data:s.options.data,success:function(t){s.$modal.find(".modal-body").html(t),s.options.cache&&void 0===s.options.remote_o&&(s.options.content=t,s.options.remote_o=s.options.remote,delete s.options.remote),"function"==typeof s.options.onLoadSuccess&&s.options.onLoadSuccess(s)}})},reload:function(){var t=void 0!==this.options.remote_o?this.options.remote_o:void 0!==this.options.remote?this.options.remote:"";""!==t?this.load(t):this.options.content&&(this.$modal.find(".modal-body").html(this.options.content),"function"==typeof this.options.onLoadSuccess&&this.options.onLoadSuccess(this))},close:function(){var o=t(".modal:visible").length,s=this.$modal;return this.$modal.removeClass("in").off("."+n).find(".modal-body").html(""),setTimeout(function(){s.hide()},200),void 0!==this.options.cssclass&&this.$modal.removeClass(this.options.cssclass),t(document).off("keyup."+n),o<2&&(t("body").removeClass("modal-open"),t(".modal-backdrop").remove()),"function"==typeof this.options.onClose&&this.options.onClose.call(this,this.options),this},destroy:function(){return this.$modal.remove(),t(document).off("keyup."+n),t(".modal-backdrop").remove(),t("body").removeClass("modal-open"),this.$modal=null,this},escape:function(){var o=this;t(document).on("keyup."+n,function(t){27===t.which&&o.close()})}}),t.fn[n]=function(o){return this.each(function(){var i;if(!(i=t.data(this,n))){var e=t(this),a=e.data(),d=t.extend({},o,a);""!==e.attr("href")&&"#"!==e.attr("href")&&(d.remote=e.attr("href")),i=new s(d),t.data(this,n,i)}i.show()})},t[n]=function(t){return new s(t)},t.fn[n].defaultBtns=function(){var o=[];return o.submit={id:"submit",title:"提 交",icon:"fa fa-save",btnClass:"btn btn-primary modal-btn-submit",attrString:'data-loading-text="提交中.."',onclick:function(o,s){var i=t.fn[n].defaultBtnsGetForm(s);return i.length>0?i.submit():s.$modal.trigger("close"),!1}},o.reset={id:"reset",title:"重置",icon:"fa fa-undo",btnClass:"btn  btn-default modal-btn-reset",onclick:function(o,s){t.fn[n].defaultBtnsGetForm(s)[0].reset()}},o.cancel={id:"cancel",title:"取消",icon:"fa fa-times",btnClass:"btn  btn-default modal-btn-close",onclick:function(t,o){o.$modal.trigger("close")}},o.close={id:"close",title:"關閉",icon:"fa fa-times",btnClass:"btn  btn-default modal-btn-close",onclick:function(t,o){o.$modal.trigger("close")}},o.refresh={id:"refresh",title:"刷新",icon:"fa fa-refresh",btnClass:"btn  btn-default modal-btn-refrest",onclick:function(t,o){o.reload()}},o},t.fn[n].defaultBtnsGetForm=function(o){var s=o.$modal.find("form").length;if(1===s)return t(o.$modal.find("form"));if(s>1){var n=o.$modal.find(".table_edit").find("form");return n.length>0?n:o.$modal.find(".form-modal-submit")}return!1},t.fn[n].createBtn=function(o,s){var n={tag:"a",btnClass:"btn btn-default",icon:"fa fa-arrow-right",attrString:""},i=t.extend({},n,s),e="a"===i.tag?' href="javascript:void(0)"':"",a="string"==typeof i.onclick?' onclick="'+i.onclick+'"':"",d="<"+i.tag+e+a+' class="'+i.btnClass+'" '+i.attrString+">";d+='<i class="'+i.icon+'"></i>&nbsp;&nbsp;'+i.title,d+="</"+i.tag+">";var l=t(d);return"function"==typeof i.onclick&&l.click(function(){i.onclick(this,o)}),l},t.fn[n].createBtnBar=function(o){var s=o.$modal.find(".modal-footer");if("string"==typeof o.options.btns)s.html(o.options.btns);else if("object"==typeof o.options.btns){var i,e,a=["submit","reset","close","cancel","refresh"];t.each(o.options.btns,function(d,l){var r=t.fn[n].defaultBtns();if("string"==typeof l){var c=t.trim(l.toLowerCase());i=t("<span>"+l+"</span>"),t.inArray(c,a)>-1&&(e=r[c],i=t.fn[n].createBtn(o,e))}else if("object"==typeof l){var f=void 0===l.id?"":t.trim(l.id.toLowerCase());e=t.inArray(f,a)<0?l:t.extend({},r[f],l),i=t.fn[n].createBtn(o,e)}s.append(i)})}},t.fn[n].options={},t.fn[n].defaults={title:"&nbsp;",target:"#modal",content:"",appendTo:"body",cache:!1,keyboard:!0,nobackdrop:!1,draggable:!1,data:"",handle:".modal-header",btns:["refresh","cancel","submit"]},t(document).on("click."+n,'[data-trigger="modal"]',function(){if(t(this)[n](),t(this).is("a"))return!1}).on("click."+n,'[data-dismiss="modal"]',function(o){o.preventDefault(),t(this).closest(".modal").trigger("close")})}(jQuery);